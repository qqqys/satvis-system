<template>
  <div class="container">
    <div id="cesiumContainer">
      <web-socket @cmsg="fmsg"></web-socket>
    </div>
  </div>
</template>

<script>
import { defineComponent, onMounted } from '@vue/runtime-core';
import * as Cesium from 'cesium'

import {nextTick} from 'vue'
import { ElMessage } from 'element-plus';
import changePos from './function/changePos';
import createSat from './function/createSat';
import WebSocket from './components/WebSocket.vue';
import addTrack from './function/addTrack';
export default defineComponent({
  components: {
    WebSocket
  },
  setup(){
    onMounted(() =>{
      Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxMTdmMTdmNS00NzZhLTQwOGMtODQwYy1kZjAyMzNiOTg0ZTYiLCJpZCI6MzMwMjQsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1OTc4OTE3ODl9.yqF540oYBpSme38SIPKUP4t14FA6hXCLFHnvOqPf_Fw';
      let viewer = new Cesium.Viewer('cesiumContainer', {
          geocoder:false, //一种地理位置搜索工具，用于显示相机访问的地理位置。默认使用微软的Bing地图。
          homeButton:true, //首页位置，点击之后将视图跳转到默认视角。
          sceneModePicker:true, //切换2D、3D 和 Columbus View (CV) 模式。
          baseLayerPicker:false, //选择三维数字地球的底图（imagery and terrain）。
          navigationHelpButton:true, //帮助提示，如何操作数字地球。
          animation:false,//控制视窗动画的播放速度。
          creditsDisplay:false, //展示商标版权和数据源。
          timeline:false, //展示当前时间和允许用户在进度条上拖动到任何一个指定的时间。
          fullscreenButton:true, //视察全屏按钮,
          //terrainProvider: Cesium.createWorldTerrain()//地形
      });
      viewer.scene.globe.enableLighting = true;//启用以太阳为光源的地球
      viewer._cesiumWidget._creditContainer.style.display="none" //取消版权信息显示
      window.viewer = viewer
      createSat(window.viewer, {"MessageType":"Add","UserName":"admin","TargetObject":"Sat11","TargetType":"3DModel","Model3DFile":"model/weixin.gltf","ModelIconFile":"model/weixin.png","ModelInfoString":"卫星11"})
      createSat(window.viewer, {"MessageType":"Add","UserName":"admin","TargetObject":"Sat12","TargetType":"3DModel","Model3DFile":"model/weixin.gltf","ModelIconFile":"model/weixin.png","ModelInfoString":"卫星12"})
    })
    
    //createSat(window.viewer, {"MessageType":"Add","UserName":"admin","TargetObject":"Sat11","TargetType":"3DModel","Model3DFile":"model/weixin.gltf","ModelIconFile":"model/weixin.png","ModelInfoString":"卫星11"})
    //createSat(window.viewer, {"MessageType":"Add","UserName":"admin","TargetObject":"Sat11","TargetType":"3DModel","Model3DFile":"model/weixin.gltf","ModelIconFile":"model/weixin.png","ModelInfoString":"卫星11"})

    const fmsg = (msg) =>{
      console.log(msg);
      let ret = JSON.parse(msg)
      if(ret.MessageType === 'Modify'){
        if(ret.TargetType === '3DModel'){
          changePos(window.viewer, ret)
        }
        else if(ret.TargetObject === 'Track'){
          addTrack(window.viewer, ret)
        }
      }
    }
    const cli = () => {
      let p = {"MessageType":"Add","UserName":"admin","TargetObject":"Sat11_Track","TargetType":"Track","LineType":1.0,"LineWidth":2.0,"Color":"(0,255,64)","TrackPoints":[-2572561.1232072851,6486629.8743617609,0.0,-2511601.3888345896,6495692.3592630271,438494.12426632404,-2440528.3221230512,6478598.9836475132,875222.587457985,-2359628.1092275237,6435418.576505824,1308426.8381942883,-2269226.5067521124,6366325.0100972615,1736362.5158542483,-2169687.5300433072,6271596.499827615,2157306.4745011483,-2061411.9874286545,6151614.4839739045,2569563.7213830533,-1944835.8663030886,6006862.0877670683,2971474.2420703857,-1820428.5775615694,5837922.1780171813,3361419.6847481406,-1688691.0654470855,5645475.0161145227,3737829.8767474587,-1550153.7904249907,5430295.5188570507,4099189.1470767804,-1405374.5932059349,5193250.1381339664,4444042.4294939842,-1254936.4485182075,4935293.3720297562,4771001.1215445818,-1099445.1176742641,4657463.9213972958,5078748.6759737134,-939526.70938372158,4360880.5073761176,5366045.9019972617,-775825.15863456344,4046737.3666972215,5631735.9550857935,-608999.63379421912,3716299.4429132678,5874748.995169159,-439721.88237119606,3370897.2929173373,6094106.4945048746,-268673.52612495027,3011921.7292599347,6288925.177863976,-96543.316415639361,2640818.2198377289,6458420.5791686056,75975.639154517325,2259081.0675045047,6601910.2002600562,248188.66764092585,1868247.3930409653,6718816.2590779532,419402.32795938168,1469890.9457118767,6808668.0161847,588927.20312857232,1065615.7663332182,6871103.6702670427,756080.67630893469,657049.72836595413,6905871.8149822652,920189.67945974541,245837.98304414903,6912832.4512827992,1080593.403546561,-166363.66506839707,6891957.5511429757,1236645.9593859743,-577895.42541872594,6843331.17041799,1387718.9784133937,-987100.20485546929,6767149.1103806468,1533204.1429014728,-1392330.2801581002,6663718.1292987354,1672515.6354408958,-1791953.9328367943,6533454.7072277535,1805092.4978203257,-2184362.0194868813,6376883.3689927226,1930400.8898071358,-2567974.4512414024,6194634.57211184,2047936.2387336069,-2941246.5562312882,5987442.1681665732,2157225.2712329784,-3302675.2994337953,5756140.4478403488,2257827.9189442564,-3650805.334864066,5501660.7815244235,2349339.0905121816,-3984234.8657397376,5225027.8690180453,2431390.3027471453,-4301621.2890218413,4927355.6134240227,2503651.1643769396,-4601686.6016033692,4609842.6358540738,2565830.7064158004,-4883222.546376734,4273767.449004652,2617678.5537938168,-5145095.4774586782,3920483.30903757,2658985.9335289719,-5386250.9249821538,3551412.7664950415,2689586.5153822522,-5605717.8410742832,3168041.9381907554,2709357.0816108193,-5802612.5099234432,2771914.5231419513,2718218.0231223674,-5976142.1061909171,2364625.5866383407,2716133.6600328451,-6125607.887438722,1947815.1374771411,2703112.3853367497,-6250408.0077187857,1523161.5242264862,2679206.631111505,-6350039.9409941612,1092374.6771081002,2644512.6573919905,-6424102.5046340125,657189.22271180979,2599170.1645653523,-6472297.4748344868,219357.49926647672,2543361.7308468558,-6494430.787460696,-219357.49940753958,2477312.0771018467,-6490413.319474509,-657189.22285230155,2401287.1619741446,-6460261.2478015674,-1092374.6772474614,2315593.1109644515,-6404095.9841925111,-1523161.5243641525,2220574.9837710029,-6322143.6863407167,-1947815.1376125549,2116615.3848559535,-6214734.3472250821,-2364625.5867709625,2004132.9228322459,-6082300.4663447728,-2771914.5232712422,1883580.5248744679,-5925375.3081963854,-3168041.9383161948,1755443.6129409783,-5744590.7550060246,-3551412.7666161316,1620238.1491510158,-5540674.7623626171,-3920483.3091538139,1478508.5581873369,-5314448.4279976618,-4273767.4491155911,1330825.5350901838,-5066822.6855144808,-4609842.6359592527,1177783.7472697659,-4798794.6363800932,-4927355.6135230223,1019999.4399904968,-4511443.5349495411,-5225027.869110466,858107.95496880577,-4205926.4426895138,-5501660.7816098938,692761.17207629012,-3883473.5691001993,-5756140.4479185231,524624.88444954145,-3545383.3180958079,-5987442.16823714,354376.117576187,-3193017.0597903072,-6194634.5721745118,182700.40315218631,-2827793.648740422,-6376883.3690472459,10289.018687653705,-2451183.7107191286,-6533454.7072739126,-162163.79602368723,-2064703.7210247268,-6663718.1293363422,-333963.63436313986,-1669909.8981700116,-6767149.1104095522,-504418.719017385,-1268391.9375396208,-6843331.1704380745,-672842.68752157991,-861766.61024774984,-6891957.55115416,-838557.35599873948,-451671.25297154958,-6912832.4512850391,-1000895.4499668639,-39757.174974175286,-6905871.81497555,-1159203.2912177597,372316.9911347797,-6871103.6702513993,-1312843.4299484699,782891.96812738688,-6808668.016160191,-1461197.2115466492,1190314.5154811607,-6718816.2590446807,-1603667.2676943429,1592944.0863951524,-6601910.2002181523,-1739679.9217593586,1989159.4336928783,-6458420.57911824,-1868687.4987885957,2377365.1380125089,-6288925.1778053455,-1990170.530801767,2755998.0319975019,-6094106.4944382217,-2103639.8485056353,3123533.4946199008,-5874748.995094751,-2208638.5510060932,3478491.5902910675,-5631735.95500393,-2304743.8455868056,3819443.0280399732,-5366045.9019082747,-2391568.7501462596,4145014.9167634826,-5078748.6758779539,-2468763.6514381003,4453896.2933742655,-4771001.1214424381,-2536017.7128402814,4744843.40158645,-4444042.4293858716,-2593060.1259844378,5016684.7000832362,-4099189.1469631339,-2639661.201205601,5268325.5799002638,-3737829.87662873,-2675633.2924214131,5498752.7720295787,-3361419.684624814,-2700831.552716672,5707038.4274963159,-2971474.2419429524,-2715154.517590737,5892343.8534790231,-2569563.7212520321,-2718544.513519262,6053922.8904296672,-2157306.4743670607,-2710987.8901851191,6191124.91659475,-1736362.5157176398,-2692515.075443414,6303397.4678395065,-1308426.8380557094,-2663200.4527992457,6390288.4622259652,-875222.58731799352,-2623162.0618915888,6451448.02038737,-438494.1241254718,-2572561.1231893315,6486629.8743688809,0.00014113389234533016]}
      ElMessage.success("开始")
      addProperty(window.viewer, p)
      ElMessage.success("结束")
    }

    return {
      fmsg,
      cli
    }
  }
})
</script>

<style scoped>
</style>